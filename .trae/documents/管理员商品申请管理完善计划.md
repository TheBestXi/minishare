# 管理员商品申请管理完善计划

## 功能分析

### 现有功能
- 显示商品申请列表，包含名称、价格、申请人、状态、提交时间、审核信息
- 支持审核（通过/驳回）申请
- 显示审核结果信息

### 需求功能
1. **删除申请记录功能**：管理员可以删除商品申请记录
2. **商品申请详细表单页面**：显示商品申请的完整信息
   - 商品图片
   - 商品名称、价格、描述
   - 商品配送详细信息
3. **申请记录跳转功能**：点击申请记录跳转到对应的详细表单页

## 实现路线分析

### 1. 控制器设计

#### 方案：创建专门的 ProductRequestController
- **优势**：避免 AdminController 过于臃肿，提高代码可维护性
- **路由**：使用 `Admin/ProductRequests` 路由，保持一致性
- **功能分离**：专门处理商品申请相关功能

#### 控制器方法设计

| 方法名 | HTTP 方法 | 功能描述 |
|--------|-----------|----------|
| `Index` | GET | 显示商品申请列表 |
| `Details` | GET | 显示商品申请详细信息 |
| `Delete` | POST | 删除商品申请记录 |
| `Approve` | POST | 批准商品申请 |
| `Reject` | POST | 驳回商品申请 |

### 2. 视图设计

#### 2.1 商品申请列表页 (ProductRequests.cshtml)
- 修改表格，添加删除按钮
- 将商品名称修改为链接，点击跳转到详细页面
- 优化表格样式，提高可读性

#### 2.2 商品申请详细页 (Details.cshtml)
- 显示完整的商品申请信息
- 包含图片预览、商品详情、配送信息等
- 添加返回按钮和审核操作按钮

### 3. 数据访问优化

#### 3.1 导航属性加载
- 确保 `ProductRequest` 查询包含所有必要的导航属性
- 包含 `RequestedBy`、`ReviewedBy`、`OriginalProduct`、`ProductImages`

#### 3.2 图片处理
- 正确处理商品申请的图片展示
- 支持多图片预览

### 4. 代码复用与优化

#### 4.1 局部视图
- 创建 `_ProductDetails.cshtml` 局部视图，复用商品信息展示
- 创建 `_ImagePreview.cshtml` 局部视图，复用图片预览功能

#### 4.2 服务层考虑
- 未来可以考虑创建 `IProductRequestService` 服务层
- 分离业务逻辑，提高代码可测试性

## 具体实现步骤

### 步骤 1：创建 ProductRequestController
- 从 AdminController 中分离商品申请相关功能
- 实现所有必要的控制器方法

### 步骤 2：修改 ProductRequests 视图
- 添加删除按钮
- 修改商品名称为链接，指向详情页
- 优化表格样式

### 步骤 3：创建 ProductRequestDetails 视图
- 显示完整的商品申请信息
- 包含图片预览、商品详情、配送信息
- 添加返回和审核按钮

### 步骤 4：测试功能
- 测试商品申请详情页的显示
- 测试删除申请记录功能
- 测试审核功能是否正常

## 代码结构优化

### 控制器结构
```
Controllers/
├── AdminController.cs              # 管理员主控制器
├── ProductRequestController.cs     # 商品申请管理控制器
├── UserPostsController.cs          # 用户帖子控制器
└── UserProductsController.cs       # 用户商品控制器
```

### 视图结构
```
Views/
├── Admin/
│   ├── ProductRequests.cshtml      # 商品申请列表
│   └── ProductRequestDetails.cshtml # 商品申请详情
└── Shared/
    ├── _ImagePreview.cshtml        # 图片预览局部视图
    └── _ProductDetails.cshtml      # 商品详情局部视图
```

## 预期效果

1. **商品申请列表页**：
   - 商品名称为可点击链接
   - 每个申请记录包含删除按钮
   - 保持现有审核功能

2. **商品申请详情页**：
   - 完整展示商品申请的所有信息
   - 支持图片预览
   - 包含审核操作按钮
   - 包含返回列表按钮

3. **删除功能**：
   - 管理员可以删除申请记录
   - 删除前有确认提示
   - 删除后返回申请列表

## 技术要点

- **ASP.NET Core MVC**：使用控制器和视图实现功能
- **Entity Framework Core**：处理数据库操作
- **Bootstrap**：实现响应式设计
- **Font Awesome**：使用图标增强用户体验
- **局部视图**：提高代码复用性

## 注意事项

1. **权限控制**：确保只有管理员可以访问这些功能
2. **数据完整性**：删除申请记录时，确保同时删除相关的图片记录
3. **用户体验**：提供清晰的操作反馈和错误处理
4. **性能优化**：合理加载导航属性，避免N+1查询问题
5. **代码可维护性**：遵循单一职责原则，保持代码结构清晰